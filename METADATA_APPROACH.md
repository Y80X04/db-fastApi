# Различия в подходах к работе с базой данных

## Старый проект (src_old) - Подход с метаданными

В старом проекте используется подход с явным определением таблиц через `MetaData` и `Table`:

### Преимущества:
- Явный контроль над структурой таблиц
- Гибкость в определении сложных связей
- Простота миграций для простых случаев
- Более прямое взаимодействие с SQLAlchemy Core
- **Автоматическое создание таблиц при импорте моделей**
- **Автоматическое заполнение начальными данными**

### Пример из старого проекта:
```python
from sqlalchemy import Table, Column, Integer, String, MetaData

metadata = MetaData()

operation = Table(
    "operation",
    metadata,
    Column("id", Integer, primary_key=True),
    Column("quantity", String),
    Column("figi", String),
    # ... другие колонки
)
```

## Новый проект (src) - Подход с моделями

В новом проекте используется современный подход с классами моделей, наследующими от `Base`. **Теперь также добавлена поддержка автоматического создания таблиц и заполнения начальными данными при первом запуске** (как в старом проекте).

### Преимущества:
- Более объектно-ориентированный подход
- Лучшая интеграция с ORM
- Поддержка миграций через Alembic
- Автоматическая генерация схемы базы данных
- **Автоматическое создание таблиц при первом запуске**
- **Автоматическое заполнение начальными данными**

### Пример из нового проекта:
```python
from sqlalchemy import Column, Integer, String
from src.database import Base

class Operation(Base):
    __tablename__ = "operation"
    
    id = Column(Integer, primary_key=True)
    quantity = Column(String)
    figi = Column(String)
    # ... другие колонки
```

## Когда использовать каждый подход:

### Подход с метаданными (как в src_old):
- Когда нужен точный контроль над структурой таблиц
- Для сложных миграций
- Когда предпочтительнее работать с SQLAlchemy Core
- Для legacy систем

### Подход с моделями (как в src):
- Для новых проектов
- Когда важна интеграция с ORM
- При использовании систем миграций (Alembic)
- Для современных веб-приложений
- **Когда нужно автоматическое создание таблиц и заполнение начальными данными при первом запуске**

## Автоматическое создание таблиц и заполнение данными

В новом проекте добавлена функция автоматического создания таблиц и заполнения начальными данными при первом запуске приложения:

- `src/auto_create_tables.py` - модуль для автоматического создания таблиц
- `src/seed_only.py` - модуль для заполнения только начальными данными
- `src/main.py` - обновлен для вызова автоматического создания таблиц и заполнения данными
- `test_table_creation.py` - тестовый скрипт для проверки создания таблиц
- `test_seed_data.py` - тестовый скрипт для проверки заполнения начальными данными

## Примеры использования

Смотрите файлы:
- `src/metadata_example.py` - пример определения таблиц через метаданные
- `src/use_metadata_example.py` - пример использования подхода с метаданными
- `src/auto_create_tables.py` - автоматическое создание таблиц
- `src/seed_only.py` - автоматическое заполнение начальными данными
- `test_table_creation.py` - тест создания таблиц
- `test_seed_data.py` - тест заполнения начальными данными
